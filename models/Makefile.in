
.DELETE_ON_ERROR : # don't leave half-baked files around

.SECONDARY : # keep "intermediate" files (for reuse)

phrase_tables := $(wildcard phrase-table.*.gz)
binary_phrase_tables = $(patsubst %.gz,%.binphr.idx,$(phrase_tables))

#
# Binary phrase tables
#
phrase-table.%.binphr.idx : phrase-table.%.gz
	zcat $< | processPhraseTable -ttable 0 0 - -nscores 5 -out phrase-table.%

moses.binarized.ini : moses.ini $(binary_phrase_tables) 
	cp $< $@
	perl -i'.bak' -pe 's/0 (.+phrase-table.+)\.gz/1 \1/g' $@ 	# use binary phrase table
	perl -i'.bak' -pe 's/0 (\d \d \D.+lm.mmap)/9 \1/g' $@		# use binary KenLM language models
